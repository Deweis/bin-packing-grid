<!--
  <bin-packing-grid>

  @element bin-packing-grid
  @demo https://chris-l.github.io/bin-packing-grid/
--><html><head><template id="bin-packing-grid">
  <style>
    :host {
      display   : block;
      position  : relative;
    }
    :host ::content > bin-packing-item, :host > .bin-packing-filler, :host ::content > .bin-packing-filler {
      display   : block;
      position  : absolute;
      box-sizing: border-box;
    }
  </style>
  <content></content>
</template>

<script>!function(){"use strict";function a(a,b){return document.defaultView.getComputedStyle(a,null).getPropertyValue(b)}function b(a){return a.map(function(a){return a.slice(0)})}function c(a,c,d,e,f,g){var h,j;if(c+f>g)return!1;for(a=b(a),j=d;d+e>j;j+=1)for(void 0===a[j]&&(a[j]=i()),h=c;c+f>h;h+=1){if(1===a[j][h])return!1;a[j][h]=1}return a}function d(a,c){function d(a,b){var d=document.createElement("div");c.root.appendChild(d),d.style.width=c.cellSize+"px",d.style.height=c.cellSize+"px",d.style.top=(c.cellSize+c.gutterSize)*a+"px",d.style.left=(c.cellSize+c.gutterSize)*b+"px",d.className="bin-packing-filler"}g(c.root.querySelectorAll(".bin-packing-filler"),function(a){c.root.removeChild(a)});var e,f,h;for(h=b(a),h.reverse(),e=0;e<h.length;e+=1)for(f=0;f<c.columns;f+=1)0===h[e][f]&&(0===e?h[e][f]=!1:h[e-1][f]===!1?h[e][f]=!1:d(a.length-e-1,f))}function e(a,b){var e,f;f=[i()],e=Array.prototype.slice.call(a,0),e.forEach(function(a){var d,e,g,h,i,j,k=[];for(d=0;d<f.length;d+=1)for(e=0;e<b.columns;e+=1)if(0===f[d][e]&&(g=c(f,e,d,a.rows,a.cols,b.columns),g!==!1)){j=f[d].indexOf(1,e),k.push({grid:g,left:f[d].slice(e,j),y:d,x:e});break}if(k.length>0)return k.sort(function(a,b){return a.grid.length<b.grid.length?-1:a.grid.length>b.grid.length?1:a.y<b.y?-1:a.y>b.y?1:a.x>b.x?-1:a.x<b.x?1:0}),i=k.shift(),a.item.setAttribute("top",i.y),a.item.setAttribute("left",i.x),void(f=i.grid);if(h=f.length,g=c(f,0,f.length,a.rows,a.cols,b.columns),g===!1)throw new Error("The element does not fit!");f=g,a.item.setAttribute("top",h),a.item.setAttribute("left",0)}),d(f,b),b.style.height=f.length*(b.cellSize+b.gutterSize)+"px"}function f(b){var c,d;b.style.width="auto",d=setInterval(function(){c=parseInt(a(b,"width"),10),isNaN(c)||(clearInterval(d),b.columns=function(){var a,d;return a=Math.floor(c/(b.cellSize+b.gutterSize)),d=b.elements.slice(0).sort(function(a,b){return a.rows>b.rows}).pop().rows,d>a?d:a}(),i=function(){return Array.apply(0,Array.call(0,b.columns)).map(function(){return 0})},b.style.width=b.columns*(b.cellSize+b.gutterSize)-b.gutterSize+"px",e(b.elements,b))},1)}var g,h,i,j,k,l,m,n,o,p;h=Function.prototype.call.bind(Array.prototype.map),g=Function.prototype.call.bind(Array.prototype.forEach),p=function(){var a,b;return a=(document._currentScript||document.currentScript).ownerDocument,window.ShadowDOMPolyfill&&(b=document.createElement("style"),document.head.insertBefore(b,document.head.firstChild)),function(c,d,e){var f,g;c.root=c.createShadowRoot(),f=a.getElementById(d),c.root.appendChild(f.content.cloneNode(!0)),window.ShadowDOMPolyfill&&(g=c.root.getElementsByTagName("style"),Array.prototype.forEach.call(g,function(a){f.shimmed||(b.innerHTML+=a.innerHTML.replace(/:host\b/gm,e||d).replace(/::content\b/gm,"")),a.parentNode.removeChild(a)}),f.shimmed=!0)}}(),o=function(){function a(a){return parseFloat(a||0,10)}function b(a){return a.replace(/([A-Z])/g,"-$1").toLowerCase()}function c(a){return a.split("-").map(function(a,b){return 0===b?a:a[0].toUpperCase()+a.slice(1)}).join("")}var d={};return d.serialize=function(a){return a.toString()},d.syncProperty=function(b,d,e,f){var g=c(e);d[g]&&(b[g]=a(f))},d.init=function(c,e){Object.defineProperty(c,"props",{enumerable:!1,configurable:!0,value:{}}),Object.keys(e).forEach(function(f){var g,h,i=b(f);g=e[f].type?e[f]:{type:e[f]},h="function"==typeof g.value?g.value():g.value,c.props[f]=c[f]||h,null===c.getAttribute(i)?c.setAttribute(i,d.serialize(c.props[f])):c.props[f]=a(c.getAttribute(i),g.type),Object.defineProperty(c,f,{get:function(){return c.props[f]||a(c.getAttribute(i),g.type)||h},set:function(a){c.props[f]=a,c.setAttribute(i,d.serialize(a)),"function"==typeof c[g.observer]&&c[g.observer](a)}})})},d}(),k=Object.create(HTMLElement.prototype),m={cellSize:{type:Number,value:100},gutterSize:{type:Number,value:5}},k.reflow=function(){var a,b=this;a=this.querySelectorAll("bin-packing-item"),g(a,function(a){a.gutterSize=b.gutterSize,a.baseSize=b.cellSize+b.gutterSize}),this.elements=h(a,function(a){var b,c;return b="number"==typeof a.cols?a.cols:parseInt(a.getAttribute("cols"),10)||0,c="number"==typeof a.rows?a.rows:parseInt(a.getAttribute("rows"),10)||0,{area:b*c,cols:b,rows:c,item:a}}),j&&window.removeEventListener("resize",j),j=f.bind(0,b),window.addEventListener("resize",j),j()},k.createdCallback=function(){p(this,"bin-packing-grid"),o.init(this,m),this.elements=this.elements||[],this.reflow()},document.registerElement("bin-packing-grid",{prototype:k}),l=Object.create(HTMLElement.prototype),n={top:{type:Number,observer:"change",value:0},left:{type:Number,observer:"change",value:0},cols:{type:Number,observer:"change",value:1},rows:{type:Number,observer:"change",value:1},baseSize:{type:Number,observer:"change",value:0},gutterSize:{type:Number,observer:"change",value:0}},l.change=function(){this.style.top=this.baseSize*this.top+"px",this.style.left=this.baseSize*this.left+"px",this.style.width=this.cols*this.baseSize-this.gutterSize+"px",this.style.height=this.rows*this.baseSize-this.gutterSize+"px"},l.attributeChangedCallback=function(a,b,c){o.syncProperty(this,n,a,c)},l.createdCallback=function(){var a,b,c;p(this,"bin-packing-item"),o.init(this,n),c=this,a=this.parentNode,null!==a&&(b=setInterval(function(){a.cellSize&&(clearInterval(b),c.gutterSize=a.gutterSize,c.baseSize=a.cellSize+a.gutterSize)},1))},document.registerElement("bin-packing-item",{prototype:l})}();</script>
</head><body></body></html>